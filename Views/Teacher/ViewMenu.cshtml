@model mess_management.Models.WeeklyPlan
@using System
@using System.Globalization

@{
    ViewData["Title"] = "Today's Menu";
    ViewData["HideBackButton"] = true;
    var todayDayOfWeek = (int)DateTime.Now.DayOfWeek;
    var currentDayPlan = Model?.Days?.FirstOrDefault(d => d.DayOfWeek == todayDayOfWeek);
    var weekStart = Model?.WeekStart.ToString("MMMM dd, yyyy") ?? "N/A";
    var todayName = DateTime.Now.ToString("dddd");
}

<div class="container-fluid mt-4 mb-5">
    
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="display-5 fw-bold text-gradient">
                <i class="fas fa-utensils me-2"></i>Menu & Pricing
            </h1>
            <p class="text-muted lead">Check out what's cooking today!</p>
        </div>
        <a href="@Url.Action("Dashboard", "Teacher")" class="btn btn-outline-secondary btn-lg rounded-pill px-4">
            <i class="fas fa-arrow-left me-2"></i>Back
        </a>
    </div>

    @if (Model != null)
    {
        <!-- TODAY'S MENU HERO SECTION -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card border-0 shadow-lg overflow-hidden hero-card">
                    <div class="card-body p-0">
                        <div class="row g-0">
                            <!-- Left: Date & Status -->
                            <div class="col-md-5 bg-gradient-premium text-white p-5 d-flex flex-column justify-content-center text-center position-relative overflow-hidden">
                                <!-- Decorative Circles -->
                                <div class="position-absolute top-0 start-0 translate-middle rounded-circle bg-white opacity-10" style="width: 200px; height: 200px;"></div>
                                <div class="position-absolute bottom-0 end-0 translate-middle rounded-circle bg-white opacity-10" style="width: 150px; height: 150px;"></div>
                                
                                <h4 class="text-uppercase letter-spacing-2 opacity-90 mb-2">Today is</h4>
                                <h1 class="display-2 fw-bolder mb-3 text-nowrap">@todayName</h1>
                                <p class="lead mb-0 opacity-90">@DateTime.Now.ToString("MMMM dd, yyyy")</p>
                                <div class="mt-4">
                                     <span class="badge glass-badge rounded-pill px-4 py-2 fs-6">
                                         Active Week: @Model.WeekStart.ToString("MMM dd") - @Model.WeekStart.AddDays(6).ToString("MMM dd")
                                     </span>
                                </div>
                            </div>

                            <!-- Right: The Menu Items -->
                            <div class="col-md-7 p-5 bg-white d-flex flex-column justify-content-center">
                                <h2 class="mb-4 text-primary fw-bold border-bottom pb-2 d-inline-block">Today's Special</h2>
                                
                                @if (currentDayPlan != null)
                                {
                                    <div class="row g-4">
                                        <!-- Breakfast -->
                                        <div class="col-md-4">
                                            <div class="meal-item h-100 p-4 rounded-4 border-start border-5 border-warning bg-soft-warning hover-lift transition-all">
                                                <div class="d-flex align-items-center mb-3">
                                                    <div class="icon-sq bg-warning text-white shadow-sm me-3">
                                                        <i class="fas fa-coffee fa-lg"></i>
                                                    </div>
                                                    <h5 class="mb-0 fw-bold text-dark">Breakfast</h5>
                                                </div>
                                                <p class="fs-5 text-secondary mb-2 fw-medium">@currentDayPlan.BreakfastName</p>
                                                <div class="text-warning fw-bolder fs-5">Rs. @currentDayPlan.BreakfastPrice.ToString("0.##")</div>
                                            </div>
                                        </div>

                                        <!-- Lunch -->
                                        <div class="col-md-4">
                                            <div class="meal-item h-100 p-4 rounded-4 border-start border-5 border-success bg-soft-success hover-lift transition-all">
                                                <div class="d-flex align-items-center mb-3">
                                                    <div class="icon-sq bg-success text-white shadow-sm me-3">
                                                        <i class="fas fa-hamburger fa-lg"></i>
                                                    </div>
                                                    <h5 class="mb-0 fw-bold text-dark">Lunch</h5>
                                                </div>
                                                <p class="fs-5 text-secondary mb-2 fw-medium">@currentDayPlan.LunchName</p>
                                                <div class="text-success fw-bolder fs-5">Rs. @currentDayPlan.LunchPrice.ToString("0.##")</div>
                                            </div>
                                        </div>

                                        <!-- Dinner -->
                                        <div class="col-md-4">
                                            <div class="meal-item h-100 p-4 rounded-4 border-start border-5 border-info bg-soft-info hover-lift transition-all">
                                                <div class="d-flex align-items-center mb-3">
                                                    <div class="icon-sq bg-info text-white shadow-sm me-3">
                                                        <i class="fas fa-moon fa-lg"></i>
                                                    </div>
                                                    <h5 class="mb-0 fw-bold text-dark">Dinner</h5>
                                                </div>
                                                <p class="fs-5 text-secondary mb-2 fw-medium">@currentDayPlan.DinnerName</p>
                                                <div class="text-info fw-bolder fs-5">Rs. @currentDayPlan.DinnerPrice.ToString("0.##")</div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle me-2"></i> No menu defined for today.
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FULL WEEK SCHEDULE -->
        <div class="d-flex align-items-center mb-4">
            <div class="bg-primary rounded-pill p-2 me-3">
                <i class="fas fa-calendar-alt text-white"></i>
            </div>
            <h3 class="fw-bold text-secondary mb-0">Full Week Schedule</h3>
        </div>
        
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
            @foreach (var day in Model.Days.OrderBy(d => d.DayOfWeek == 0 ? 7 : d.DayOfWeek)) 
            {
                var isToday = day.DayOfWeek == todayDayOfWeek;
                var dayName = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetDayName((DayOfWeek)day.DayOfWeek);

                <div class="col">
                    <div class="card h-100 border-0 shadow-sm day-card @(isToday ? "border-primary border-2 ring-primary" : "")">
                        <div class="card-header border-0 bg-transparent pt-3 pb-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0 fw-bold @(isToday ? "text-primary" : "text-dark")">
                                    @dayName
                                    @if(isToday) { <span class="badge bg-primary ms-2 animate-pulse">Running</span> }
                                </h5>
                                <small class="text-muted fw-bold">Day @(day.DayOfWeek == 0 ? 7 : day.DayOfWeek)</small>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item px-0 py-3 d-flex justify-content-between align-items-center border-bottom-dashed">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-coffee text-warning me-3 width-20"></i> 
                                        <span class="text-secondary fw-medium">@day.BreakfastName</span>
                                    </div>
                                    <span class="badge bg-light text-dark border fw-bold">Rs. @day.BreakfastPrice.ToString("0.#")</span>
                                </li>
                                <li class="list-group-item px-0 py-3 d-flex justify-content-between align-items-center border-bottom-dashed">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-hamburger text-success me-3 width-20"></i> 
                                        <span class="text-secondary fw-medium">@day.LunchName</span>
                                    </div>
                                    <span class="badge bg-light text-dark border fw-bold">Rs. @day.LunchPrice.ToString("0.#")</span>
                                </li>
                                <li class="list-group-item px-0 py-3 d-flex justify-content-between align-items-center border-0">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-moon text-info me-3 width-20"></i> 
                                        <span class="text-secondary fw-medium">@day.DinnerName</span>
                                    </div>
                                    <span class="badge bg-light text-dark border fw-bold">Rs. @day.DinnerPrice.ToString("0.#")</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>
        <!-- WATER CHARGES INFO -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card border-0 shadow-sm bg-gradient-premium text-white rounded-4 overflow-hidden">
                    <div class="card-body p-4 p-md-5 d-flex align-items-center justify-content-between flex-wrap position-relative">
                        <!-- Background decoration -->
                        <div class="position-absolute top-0 end-0 translate-middle icon-sq bg-white opacity-10 rounded-circle" style="width: 300px; height: 300px;"></div>
                        
                        <div class="d-flex align-items-center mb-4 mb-md-0 position-relative z-1">
                            <div class="icon-sq bg-white text-primary shadow-sm me-4 flex-shrink-0" style="width: 70px; height: 70px;">
                                <i class="fas fa-tint fa-2x"></i>
                            </div>
                            <div>
                                <h3 class="fw-bold mb-1">Fixed Water Charges</h3>
                                <p class="mb-0 opacity-90 fs-5">Note: This fixed monthly amount covers mineral water and maintenance services.</p>
                            </div>
                        </div>
                        <div class="text-end position-relative z-1">
                             <div class="display-4 fw-bold">Rs. 800</div>
                             <div class="opacity-75 fw-bold text-uppercase letter-spacing-2">Per Month</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <img src="https://cdni.iconscout.com/illustration/premium/thumb/empty-state-2130362-1800926.png" alt="No Menu" class="img-fluid mb-4" style="max-width: 300px; opacity: 0.8;">
            <h3 class="text-muted">No Menu Available</h3>
            <p class="text-muted">The admin hasn't created a menu for this week yet.</p>
        </div>
    }
</div>

<style>
    /* Premium Styling */
    :root {
        --primary-gradient: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%);
        --premium-gradient: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    }
    
    .bg-gradient-premium {
        background: var(--premium-gradient);
    }

    .text-gradient {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .glass-badge {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
    }

    .hero-card {
        border-radius: 1.5rem;
    }

    .hover-lift {
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease;
    }
    
    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    .icon-sq {
        width: 50px;
        height: 50px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Soft Backgrounds */
    .bg-soft-warning { background-color: #fffbeb; }
    .bg-soft-success { background-color: #f0fdf4; }
    .bg-soft-info { background-color: #eff6ff; }
    
    /* Typography & Spacing */
    .letter-spacing-2 { letter-spacing: 2px; }
    .width-20 { width: 24px; text-align: center; }
    .border-bottom-dashed { border-bottom: 1px dashed #e5e7eb; }
    
    .day-card {
        transition: all 0.3s ease;
        border-radius: 1.2rem;
        background: white;
    }
    
    .day-card:hover {
        box-shadow: 0 10px 25px rgba(0,0,0,0.08) !important;
        transform: translateY(-5px);
    }

    .opacity-10 { opacity: 0.1; }
    .opacity-90 { opacity: 0.9; }

    /* Pulse Animation for Today Badge */
    @@keyframes pulse {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); }
        70% { transform: scale(1.05); box-shadow: 0 0 0 6px rgba(37, 99, 235, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
    }
    
    .animate-pulse {
        animation: pulse 2s infinite;
    }
    
    /* Ring text helper */
    .ring-primary {
         box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2) !important;
    }
</style>
